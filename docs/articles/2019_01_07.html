<!DOCTYPE html>
<html>
  <head>
    <title>GPU vs CPU Benchmarks for OpendTect Attribute Plugins</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <!-- Bootstrap -->
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- mathjax for asciimath -->
   
    <link href="/OpendTect-Plugin-Docs/css/site.css" rel="stylesheet" media="screen">
    <link href="/OpendTect-Plugin-Docs/css/syntax.css" rel="stylesheet" media="screen">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62607269-1', 'auto');
  ga('send', 'pageview');

</script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
   <link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css">
  </head>

  <body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/OpendTect-Plugin-Docs/">OpendTect Plugins</a>
        </div>
        <div class="navbar-collapse collapse">

          <ul class="nav navbar-nav navbar-left">
            <li class="dropdown">
              <a href="/OpendTect-Plugin-Docs/installation/" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/OpendTect-Plugin-Docs/installation/download-binary.html">Download Binary Distribution</a></li>
                <li><a href="/OpendTect-Plugin-Docs/installation/installation.html">Installation</a></li>
                <li><a href="/OpendTect-Plugin-Docs/installation/building-from-source.html">Building from Source</a></li>
                <li><a href="/OpendTect-Plugin-Docs/installation/faq.html">Frequently Asked Questions</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="/OpendTect-Plugin-Docs/plugins/" class="dropdown-toggle" data-toggle="dropdown">Plugins <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/OpendTect-Plugin-Docs/plugins/AVOAttrib.html">AVOAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/AVOPolarAttrib.html">AVOPolarAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/ExternalAttrib.html">ExternalAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GeopackageDisplay.html">GeopackageDisplay</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GeopackageExport.html">GeopackageExport</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GeotiffExport.html">GeotiffExport</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GradientAttrib.html">GradientAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/Grid2D-3D.html">Grid 2D-3D Horizon</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/LocalAttrib.html">LocalAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/MLVFilter.html">MLVFilterAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/Mistie.html">Mistie</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/RSpecAttrib.html">RSpecAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/WMTools.html">WMTools</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="/OpendTect-Plugin-Docs/external_attributes/" class="dropdown-toggle" data-toggle="dropdown">External Attributes <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/AVO_IG.html">AVO Intercept and Gradient</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Add_Noise.html">Add Noise</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/DipandAzimuth.html">Dip and Azimuth</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/LPA_Smooth.html">LPA Smoothing</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Spatial_Filter_Circular.html">Spatial Filter - Circular</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Spatial_Filter_Rectangular.html">Spatial Filter - Rectangular</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Z_Delay_Est.html">Time Delay Estimation</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Vector_Filters.html">Vector Filter</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/ZC_Block.html">ZC Block</a></li>
              </ul>
            </li>
            <li class="active"><a href="/OpendTect-Plugin-Docs/articles/">Articles</a></li>
          </ul>

          <form class="navbar-form navbar-left" action="/search.html" role="search">
            <div class="form-group">
              <input type="text" required name="q" id="tipue_search_input" class="form-control" placeholder="Search"> 
            </div>
          </form>

          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://waynegm.github.io/OpendTect-Plugin-Docs/installation/download-binary.html"><button class="button" ><i class="fa fa-download" style="color:rgb(24,188,156);"></i><b style="color:rgb(24,188,156);">Download them Now</b></button></a></li>
            <li><a href="https://github.com/waynegm/OpendTect-Plugins"><i class="fa fa-github fa-lg" title="OpendTect Plugins on Github"></i></a></li>
            <li><a href="https://www.linkedin.com/in/waynemogg"><i class="fa fa-linkedin fa-lg" title="My LinkedIn"></i></a></li>
            <li><a href="https://waynegm.github.io/"><img src="https://waynegm.github.io/images/logo_thin_small.png" height="20px"></a></li>
          </ul>

        </div><!--/.nav-collapse -->
      </div>
    </div>


<div class="container-fluid">

  <ol class="breadcrumb">
    <li><a href="/OpendTect-Plugin-Docs/">Home</a></li>
      <li><a href="/OpendTect-Plugin-Docs/articles/">Articles</a></li>
      <li class="active">GPU vs CPU Benchmarks for OpendTect Attribute Plugins</li>
  </ol>

  <div class="page-header">
    <h1>GPU vs CPU Benchmarks for OpendTect Attribute Plugins</h1>
  </div>

  <div class="row">

    <div class="col-md-9 content" role="main">
    <main>
      <h3 id="summary">Summary</h3>
<p>The potential to offload calculations to the graphics processing unit (GPU) on modern graphics cards is a trending topic. I was curious if this could also apply to seismic attribute calculation in <a href="https://opendtect.org/">OpendTect</a>, so I implemented AVO polarization angle estimation as described by <a href="https://library.seg.org/doi/10.1190/1.1581037" title="AVO polarization and hodograms: AVO strength and polarization product. Patrice Nsoga Mahob and John P. Castagna, GEOPHYSICS, VOL. 68, NO. 3, MAY-JUNE 2003">Mahob and Castagna (2003)</a> using 3 different approaches:</p>
<ul>
<li>using loops for all the linear algebra and OpendTect's multi dimensional arrays (ArrayNDImpl) which I refer to as the Normal method;</li>
<li>using the <a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> linear algebra C++ template library (the Eigen method) and</li>
<li>using the <a href="https://arrayfire.com/">ArrayFire</a> linear algebra library for GPU's (the ArrayFire method).</li>
</ul>
<p>The first 2 options only use the central processing unit (CPU). ArrayFire also supports CPU calculation but for this review only the GPU capabilities were evaluated. In all cases benchmarks were run with and without OpendTect's multi-threaded processing support. Results are summarised in the following graph showing performance relative to the single threaded Normal method for a range of input data stepouts (higher performance numbers are better):</p>
<figure>
  <br/>
  <img src="images/19_01_07.png" class="img-responsive center-block" alt="">
  <br/>
</figure>

<p>The primary observations are:</p>
<ul>
<li>Both Eigen and ArrayFire can be used relatively easily within OpendTect 6.4 attribute plugins;</li>
<li>OpendTect's multi-threaded processing support offers the most performance enhancement so developing the algorithm to enable multi-threading should be the first aim;</li>
<li>The Eigen library offers a noticeable performance enhancement of up to 20% (relative to explicit coding of the linear algebra) for single trace and low-medium stepout attributes. Algorithms can also be expressed in fewer lines of code that is simpler to understand.</li>
<li>The ArrayFire library makes it relatively easy to access the GPU compute power on the graphics card but the overhead of transferring data from the CPU to the GPU is significant and can result in poorer performance in some cases. The scale and/or compute complexity of the calculations will determine if there is any benefit to GPU calculations. In general this will require benchmarking of the particular algorithm.    </li>
</ul>
<p>The code used in this evaluation is available in my <a href="https://github.com/waynegm/OpendTect-Plugins">OpendTect-Plugins</a> GitHub repository. Related details are described below.</p>
<h3 id="hardware-configuration">Hardware Configuration</h3>
<ul>
<li>Intel Core i5-3470 CPU @ 3.2Ghz</li>
<li>16GiB RAM</li>
<li>GeForce GTX1050 Ti with 4GiB RAM</li>
</ul>
<h3 id="sofware-configuration">Sofware Configuration</h3>
<p>Operating System:</p>
<ul>
<li>x86_64 GNU/Linux 4.2.0</li>
</ul>
<p>Software:</p>
<ul>
<li>OpendTect 6.4.2</li>
<li>gcc 8.2.1</li>
<li>Eigen 3.3.7</li>
<li>ArrayFire 3.6.1</li>
<li>CUDA Toolkit 10, Driver: 415.25, CUDA Compute 6.1</li>
</ul>
<h3 id="implementation">Implementation</h3>
<p>The attribute plugin source code is in my OpendTect-Plugins GitHub repository in the:</p>
<ul>
<li><a href="https://github.com/waynegm/OpendTect-Plugins/tree/master/plugins/NoRelease/AVOPolar">NoRelease/AVOPolar</a> and</li>
<li><a href="https://github.com/waynegm/OpendTect-Plugins/tree/master/plugins/NoRelease/uiAVOPolar">NoRelease/uiAVOPolar</a></li>
</ul>
<p>folders. The plugin user interface is shown in the following image:</p>
<figure>
  <br/>
  <img src="images/19_01_07-2.png" class="img-responsive center-block" alt="">
  <br/>
</figure>

<p>A comparison of the compute code for each method is shown below. All code assumes multi-trace intercept and gradient data in the 2D arrays with dimensions (<em>sz x ntraces</em>) named <strong><em>A</em></strong> and <strong><em>B</em></strong> respectively. Comparison of the code reveals both Eigen and ArrayFire allow significantly more concise and clearer coding of linear algebra calculations.</p>
<h4 id="normal-method">Normal Method</h4>
<div class="codehilite"><pre><span></span><span class="n">Array1DImpl</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">A2</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">Array1DImpl</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">B2</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">Array1DImpl</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">AB</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">&lt;</span><span class="n">sz</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">A2v</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">B2v</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">ABv</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">trcidx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">trcidx</span><span class="o">&lt;</span><span class="n">ntraces</span><span class="p">;</span> <span class="n">trcidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">A2v</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">A</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trcidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">A</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trcidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
        <span class="n">ABv</span> <span class="o">+=</span> <span class="n">A</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trcidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trcidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
        <span class="n">B2v</span> <span class="o">+=</span> <span class="n">B</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trcidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">trcidx</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">A2</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">A2v</span><span class="p">);</span>
    <span class="n">B2</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">B2v</span><span class="p">);</span>
    <span class="n">AB</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">ABv</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Array1DImpl</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">A2win</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">windowedOps</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span> <span class="n">A2</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">A2win</span> <span class="p">);</span>
<span class="n">Array1DImpl</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">B2win</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">windowedOps</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span> <span class="n">B2</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">B2win</span> <span class="p">);</span>
<span class="n">Array1DImpl</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">ABwin</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">windowedOps</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span> <span class="n">AB</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">ABwin</span> <span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">&lt;</span><span class="n">sz</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">ABv</span> <span class="o">=</span> <span class="n">ABwin</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">A2mB2</span> <span class="o">=</span> <span class="n">A2win</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">-</span> <span class="n">B2win</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">ABv</span><span class="o">*</span><span class="n">ABv</span> <span class="o">+</span> <span class="n">A2mB2</span><span class="o">*</span><span class="n">A2mB2</span><span class="p">);</span>
    <span class="n">result</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">atan2</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">ABv</span><span class="p">,</span> <span class="n">A2mB2</span><span class="o">+</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="n">M_PI</span><span class="o">*</span><span class="mf">180.0</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">&lt;</span><span class="n">nrsamples</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
    <span class="n">setOutputValue</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">result</span><span class="p">(</span><span class="n">idx</span><span class="o">-</span><span class="n">sampgateBG_</span><span class="p">.</span><span class="n">start</span><span class="p">));</span>
</pre></div>


<h4 id="eigen-method">Eigen Method</h4>
<div class="codehilite"><pre><span></span><span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">A2</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">square</span><span class="p">().</span><span class="n">rowwise</span><span class="p">().</span><span class="n">sum</span><span class="p">();</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">B2</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">square</span><span class="p">().</span><span class="n">rowwise</span><span class="p">().</span><span class="n">sum</span><span class="p">();</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">AB</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">).</span><span class="n">rowwise</span><span class="p">().</span><span class="n">sum</span><span class="p">();</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">A2win</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">windowedOpsEigen</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span> <span class="n">A2</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">A2win</span> <span class="p">);</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">B2win</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">windowedOpsEigen</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span> <span class="n">B2</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">B2win</span> <span class="p">);</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">ABwin</span><span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<span class="n">windowedOpsEigen</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span> <span class="n">AB</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">ABwin</span> <span class="p">);</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">A2mB2</span> <span class="o">=</span> <span class="n">A2win</span> <span class="o">-</span> <span class="n">B2win</span><span class="p">;</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ArrayXd</span> <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">ABwin</span><span class="o">/</span><span class="p">(</span><span class="n">A2mB2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">ABwin</span><span class="p">.</span><span class="n">square</span><span class="p">()</span> <span class="o">+</span> <span class="n">A2mB2</span><span class="p">.</span><span class="n">square</span><span class="p">()).</span><span class="n">sqrt</span><span class="p">())).</span><span class="n">atan</span><span class="p">()</span><span class="o">/</span><span class="n">M_PI</span><span class="o">*</span><span class="mf">180.0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">&lt;</span><span class="n">nrsamples</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
    <span class="n">setOutputValue</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">result</span><span class="p">(</span><span class="n">idx</span><span class="o">-</span><span class="n">sampgateBG_</span><span class="p">.</span><span class="n">start</span><span class="p">));</span>
</pre></div>


<h4 id="arrayfire-method">ArrayFire Method</h4>
<div class="codehilite"><pre><span></span><span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">A2</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">B2</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">AB</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">sum</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">constant</span><span class="p">(</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">sampgateBG_</span><span class="p">.</span><span class="n">width</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">A2win</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">convolve1</span><span class="p">(</span><span class="n">A2</span><span class="p">,</span> <span class="n">kernel</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">B2win</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">convolve1</span><span class="p">(</span><span class="n">B2</span><span class="p">,</span> <span class="n">kernel</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">ABwin</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">convolve1</span><span class="p">(</span><span class="n">AB</span><span class="p">,</span> <span class="n">kernel</span><span class="p">);</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">A2mB2</span> <span class="o">=</span> <span class="n">A2win</span> <span class="o">-</span> <span class="n">B2win</span><span class="p">;</span>
<span class="n">af</span><span class="o">::</span><span class="n">array</span> <span class="n">result</span> <span class="o">=</span> <span class="n">af</span><span class="o">::</span><span class="n">atan2</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">ABwin</span><span class="p">,</span> <span class="n">A2mB2</span> <span class="o">+</span> <span class="n">af</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">ABwin</span><span class="o">*</span><span class="n">ABwin</span> <span class="o">+</span> <span class="n">A2mB2</span><span class="o">*</span><span class="n">A2mB2</span><span class="p">))</span><span class="o">/</span><span class="n">M_PI</span><span class="o">*</span><span class="mf">180.0</span><span class="p">;</span>
<span class="kt">double</span><span class="o">*</span> <span class="n">resbuf</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">host</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">&lt;</span><span class="n">nrsamples</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
    <span class="n">setOutputValue</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">resbuf</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="n">sampgateBG_</span><span class="p">.</span><span class="n">start</span><span class="p">]);</span>
<span class="n">af</span><span class="o">::</span><span class="n">freeHost</span><span class="p">(</span><span class="n">resbuf</span><span class="p">);</span>
</pre></div>


<h3 id="method">Method</h3>
<ul>
<li>Attribute definitions were created for a range of stepouts, using a fixed window length, with/without multi-threading for each of the methods (Normal, Eigen and ArrayFire)</li>
<li>Input data volumes with ~100,000 traces were preloaded into RAM</li>
<li>The attributes were run using the OpendTect <strong>Processing|Create Seismic Output|Attributes|Single Attribute|</strong> menu item.</li>
<li>Elapsed time to evaluate the attribute were computed from the start and finish times reported in the Progress Viewer</li>
<li>Repeat runs conducted to verify consistency of the results.</li>
</ul>
    </main>
    </div>

    <div class="col-md-3" role="complementary">
      <nav class="hidden-print hidden-xs hidden-sm">
        <div class="sidebar" data-spy="affix" data-offset-top="80" data-offset-bottom="60">
          <div class="well">
            <a href="#"><strong>GPU vs CPU Benchmarks for OpendTect Attribute Plugins</strong></a>
            <div class="toc">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#hardware-configuration">Hardware Configuration</a></li>
<li><a href="#sofware-configuration">Sofware Configuration</a></li>
<li><a href="#implementation">Implementation</a><ul>
<li><a href="#normal-method">Normal Method</a></li>
<li><a href="#eigen-method">Eigen Method</a></li>
<li><a href="#arrayfire-method">ArrayFire Method</a></li>
</ul>
</li>
<li><a href="#method">Method</a></li>
</ul>
</div>

          </div>
        </div>
      </nav>
    </div>

  </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="footer">
            <hr>
            <p>All content and images &copy; 2015 by Wayne Mogg</p>
            <p>Website powered by <a href="http://urubu.jandecaluwe.com">Urubu</a></p>
        </div>
    </div>
</div>



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- <script src="https://code.jquery.com/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
 
    <script src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"></script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML">
    </script>
   </body>
</html>
