<!DOCTYPE html>
<html>
  <head>
    <title>Anatomy of a Python External Attribute</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <!-- Bootstrap -->
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- mathjax for asciimath -->
   
    <link href="/OpendTect-Plugin-Docs/css/site.css" rel="stylesheet" media="screen">
    <link href="/OpendTect-Plugin-Docs/css/syntax.css" rel="stylesheet" media="screen">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62607269-1', 'auto');
  ga('send', 'pageview');

</script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
   <link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css">
  </head>

  <body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/OpendTect-Plugin-Docs/">OpendTect Plugins</a>
        </div>
        <div class="navbar-collapse collapse">

          <ul class="nav navbar-nav navbar-left">
            <li class="dropdown">
              <a href="/OpendTect-Plugin-Docs/installation/" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/OpendTect-Plugin-Docs/installation/download-binary.html">Download Binary Distribution</a></li>
                <li><a href="/OpendTect-Plugin-Docs/installation/installation.html">Installation</a></li>
                <li><a href="/OpendTect-Plugin-Docs/installation/building-from-source.html">Building from Source</a></li>
                <li><a href="/OpendTect-Plugin-Docs/installation/faq.html">Frequently Asked Questions</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="/OpendTect-Plugin-Docs/plugins/" class="dropdown-toggle" data-toggle="dropdown">Plugins <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/OpendTect-Plugin-Docs/plugins/AVOAttrib.html">AVOAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/AVOPolarAttrib.html">AVOPolarAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/ExternalAttrib.html">ExternalAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GeopackageDisplay.html">GeopackageDisplay</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GeopackageExport.html">GeopackageExport</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GeotiffExport.html">GeotiffExport</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/GradientAttrib.html">GradientAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/Grid2D-3D.html">Grid 2D-3D Horizon</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/LocalAttrib.html">LocalAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/MLVFilter.html">MLVFilterAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/Mistie.html">Mistie</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/RSpecAttrib.html">RSpecAttrib</a></li>
                <li><a href="/OpendTect-Plugin-Docs/plugins/WMTools.html">WMTools</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="/OpendTect-Plugin-Docs/external_attributes/" class="dropdown-toggle" data-toggle="dropdown">External Attributes <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/AVO_IG.html">AVO Intercept and Gradient</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Add_Noise.html">Add Noise</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/DipandAzimuth.html">Dip and Azimuth</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/LPA_Smooth.html">LPA Smoothing</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Spatial_Filter_Circular.html">Spatial Filter - Circular</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Spatial_Filter_Rectangular.html">Spatial Filter - Rectangular</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Z_Delay_Est.html">Time Delay Estimation</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/Vector_Filters.html">Vector Filter</a></li>
                <li><a href="/OpendTect-Plugin-Docs/external_attributes/ZC_Block.html">ZC Block</a></li>
              </ul>
            </li>
            <li class="active"><a href="/OpendTect-Plugin-Docs/articles/">Articles</a></li>
          </ul>

          <form class="navbar-form navbar-left" action="/search.html" role="search">
            <div class="form-group">
              <input type="text" required name="q" id="tipue_search_input" class="form-control" placeholder="Search"> 
            </div>
          </form>

          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://waynegm.github.io/OpendTect-Plugin-Docs/installation/download-binary.html"><button class="button" ><i class="fa fa-download" style="color:rgb(24,188,156);"></i><b style="color:rgb(24,188,156);">Download them Now</b></button></a></li>
            <li><a href="https://github.com/waynegm/OpendTect-Plugins"><i class="fa fa-github fa-lg" title="OpendTect Plugins on Github"></i></a></li>
            <li><a href="https://www.linkedin.com/in/waynemogg"><i class="fa fa-linkedin fa-lg" title="My LinkedIn"></i></a></li>
            <li><a href="https://waynegm.github.io/"><img src="https://waynegm.github.io/images/logo_thin_small.png" height="20px"></a></li>
          </ul>

        </div><!--/.nav-collapse -->
      </div>
    </div>


<div class="container-fluid">

  <ol class="breadcrumb">
    <li><a href="/OpendTect-Plugin-Docs/">Home</a></li>
      <li><a href="/OpendTect-Plugin-Docs/articles/">Articles</a></li>
      <li class="active">Anatomy of a Python External Attribute</li>
  </ol>

  <div class="page-header">
    <h1>Anatomy of a Python External Attribute</h1>
  </div>

  <div class="row">

    <div class="col-md-9 content" role="main">
    <main>
      <h3 id="introduction">Introduction</h3>
<p>This article will review the structure of a simple Python <a href="/OpendTect-Plugin-Docs/plugins/ExternalAttrib.html" title="ExternalAttrib">ExternalAttrib</a> script, <a href="https://github.com/waynegm/OpendTect-External-Attributes/blob/master/Python_3/DipAndAzimuth/ex_dip.py">ex_dip.py</a>, which converts inline and crossline dip to true dip and dip azimuth. It is an example of multi attribute, single trace input and output. Some basic understanding of <a href="https://www.python.org/">Python</a> and <a href="http://www.numpy.org/">Numpy</a> is assumed.</p>
<p>Every Python attribute script has 5 sections.</p>
<h3 id="the-imports">The Imports</h3>
<p><figure>
  <br/>
  <img src="images/18_06_04_01.png" class="img-responsive center-block" alt="">
  <br/>
</figure></p>
<p>This is where external modules/libraries required by the script are loaded. At a minimum the script must load:</p>
<ul>
<li>the Python sys and os modules</li>
<li>the Numpy module (the fundamental package for scientific computing with Python)</li>
<li>the external attribute module (extattrib.py)</li>
</ul>
<p>Generally sys, os and Numpy will be part of the Python installation. The extattrib module is part of the <a href="https://github.com/waynegm/OpendTect-External-Attributes" title="external attribute scripts">external attribute scripts</a> package and its location is unknown to the Python installation unless we help out. The sys.path.insert call on line 11 provides this help by extending the default search path for Python modules to include the parent folder of the folder containing the script. This reflects the folder structure of the <a href="https://github.com/waynegm/OpendTect-External-Attributes" title="external attribute scripts">external attribute scripts</a> package, so if you develop scripts outside this structure then you will need to change line 11 appropriately to append the location of extattrib.py to the module search path.</p>
<p>Of course if your script requires other Python modules (eg SciPy, Numba) then add the appropriate import statements in this section.</p>
<h3 id="the-parameters">The Parameters</h3>
<p><figure>
  <br/>
  <img src="images/18_06_04_02.png" class="img-responsive center-block" alt="">
  <br/>
</figure></p>
<p>The xa.params global variable must be assigned a JSON object string describing the input parameters for the script. This JSON string is used by the plugin to build an input dialog box. This attribute is very simple specifying just 2 input volumes and 2 output volumes and a url for documentation. The plugin dynamically builds the following input dialog for this script:</p>
<figure>
  <br/>
  <img src="images/18_06_04_06.png" class="img-responsive center-block" alt="">
  <br/>
</figure>

<p>A variety of other input elements can be specified to build more complex input dialogs. See the <a href="/OpendTect-Plugin-Docs/plugins/ExternalAttrib.html#json-parameter-string" title="ExternalAttrib">JSON Parameter String</a> section of the plugin documentation for full details or look at other scripts to see what is possible.</p>
<h3 id="the-compute-loop-initialisation">The Compute Loop Initialisation</h3>
<p><figure>
  <br/>
  <img src="images/18_06_04_03.png" class="img-responsive center-block" alt="">
  <br/>
</figure></p>
<p>The doCompute function is where the attribute calculation occurs. The function is divided into 2 parts some initialisation and the "while True:" loop, discussed in the next section, where the calculations actually take place. Any code in this initialisation section will be executed just once when the attribute script is run and is a good place to calculate constants for use in the Compute Loop.</p>
<p>This particular script shows how information stored in the <a href="/OpendTect-Plugin-Docs/plugins/ExternalAttrib.html#seismicinfo-block" title="ExternalAttrib">SeismicInfo Block</a> can be used to calculate some constants purely as an example. This attribute is so simple that no initialisation is actually required. </p>
<h3 id="the-compute-loop">The Compute Loop</h3>
<p><figure>
  <br/>
  <img src="images/18_06_04_04.png" class="img-responsive center-block" alt="">
  <br/>
</figure></p>
<p>This is where the attribute calculation takes place. The <em>xa.doInput()</em> and <em>xa.doOutput()</em> function calls control the input and output of seismic trace data between the script and OpendTect. Generally these should be the first and last statements within the compute loop.</p>
<p>Within the compute loop, some information about the current trace data such as the number of samples and the inline and crossline location are provided in the <a href="/OpendTect-Plugin-Docs/plugins/ExternalAttrib.html#traceinfo-block" title="ExternalAttrib">TraceInfo Block</a>. These can be accessed using constructs like <em>xa.TI['nrsamp']</em>. This information is not required for this particular script.</p>
<p>The global Numpy array <em>xa.Input</em> contains the input trace data. <em>xa.Input['name of input attribute']</em> returns a Numpy array with the trace data for the current compute location. The shape of this Numpy array depends on the traces stepouts required by the attribute. As this particular script uses just single trace input (inline and crossline step out of 0) the Numpy array has a shape of <em>(1,1,xa.TI['nrsamp'])</em>. In the more general case of a multi-trace attribute the Numpy array shape would be <em>(xa.SI['nrinl'], xa.SI['nrcrl'], xa.TI['nrsamp'])</em> and the input trace at the current location would be at the centre of the array, ie at index <em>[xa.SI['nrinl']//2, xa.SI['nrcrl']//2,...]</em>.</p>
<p>Attribute ouput must be put into the <em>xa.Output</em> global Numpy array before the <em>xa.doOutput()</em> function call. Each element (eg <em>xa.Output['name of output attribute']</em>) of the output array must have a shape of <em>(1,1,xa.TI['nrsamp'])</em></p>
<h3 id="the-postamble">The Postamble</h3>
<p><figure>
  <br/>
  <img src="images/18_06_04_05.png" class="img-responsive center-block" alt="">
  <br/>
</figure></p>
<p>This section is just boilerplate code that apprears in every attribute script which should never be changed.</p>
    </main>
    </div>

    <div class="col-md-3" role="complementary">
      <nav class="hidden-print hidden-xs hidden-sm">
        <div class="sidebar" data-spy="affix" data-offset-top="80" data-offset-bottom="60">
          <div class="well">
            <a href="#"><strong>Anatomy of a Python External Attribute</strong></a>
            <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-imports">The Imports</a></li>
<li><a href="#the-parameters">The Parameters</a></li>
<li><a href="#the-compute-loop-initialisation">The Compute Loop Initialisation</a></li>
<li><a href="#the-compute-loop">The Compute Loop</a></li>
<li><a href="#the-postamble">The Postamble</a></li>
</ul>
</div>

          </div>
        </div>
      </nav>
    </div>

  </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="footer">
            <hr>
            <p>All content and images &copy; 2015 by Wayne Mogg</p>
            <p>Website powered by <a href="http://urubu.jandecaluwe.com">Urubu</a></p>
        </div>
    </div>
</div>



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- <script src="https://code.jquery.com/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
 
    <script src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"></script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML">
    </script>
   </body>
</html>
